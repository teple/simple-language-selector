name: ë¹Œë“œ ~ íŒŒì¼ ì—…ë¡œë“œ ~ readme ë‹¤ìš´ë¡œë“œ ë§í¬ ê°±ì‹ 

# master ì— í‘¸ì‰¬ë˜ì—ˆì„ ë•Œ ì‹¤í–‰
on:
  push:
    branches: [ master ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # ì¡ ì´ë¦„ì€ í¬ê²Œ ìƒê´€ ì—†ëŠ” ê²ƒ ê°™ìŒ
  deploy:
    runs-on: ubuntu-latest
    steps:
      # ì²´í¬ì•„ì›ƒ í•´ì„œ ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜´
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v2

      # Node ëª¨ë“ˆ ìºì‹± (ì‹¤í–‰ì†ë„ë¥¼ ë¹ ë¥´ê²Œ)
      # -ref: https://devblog.croquis.com/ko/2020-11-06-1-using-github-actions/
      - name: Node ëª¨ë“ˆ ìºì‹±
        uses: actions/cache@v2
        # ì•„ë˜ ë‚´ìš©ì€ ë‚˜ì¤‘ì— ì¡°ì‚¬í•´ë³´ì ğŸ“
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      # Node 14.xë¥¼ ì‚¬ìš©
      - name: ë…¸ë“œ 14 ì‚¬ìš©
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      # ì˜ì¡´ì„±ëª¨ë“ˆ ì„¤ì¹˜
      - name: ì˜ì¡´ì„±ëª¨ë“ˆ ì„¤ì¹˜
        run: npm install

      # ê²°ê³¼ë¬¼ì„ ë¹Œë“œ
      - name: ê²°ê³¼ë¬¼ì„ ë¹Œë“œ
        run: npm run build:production

      # ë¹Œë“œê²°ê³¼ë¬¼ ì••ì¶•
      - name: ë¹Œë“œê²°ê³¼ë¬¼ ì••ì¶•
        uses: thedoctor0/zip-release@master
        with:
          type: 'zip'
          filename: 'dist.zip'
          path: './dist'
      # ì••ì¶• í›„ ì¶œë ¥
      - name: ì••ì¶• í›„ ì¶œë ¥
        run: ls -alt

      # ì••ì¶•ê²°ê³¼ë¥¼ ì—…ë¡œë“œ
      - name: ì••ì¶•ê²°ê³¼ë¥¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v2
        with:
          name: dist.zip
          path: dist.zip

      # ì•„í‹°íŒ©íŠ¸ ë§í¬ë¥¼ ì·¨ë“ í›„ curl ~ jq ë¡œ redirect url ì·¨ë“
      # -ref: https://zenn.dev/tmsc4zht/scraps/5422c9d1ff3bb3
      - name: ì•„í‹°íŒ©íŠ¸ ë§í¬ë¥¼ ì·¨ë“ í›„ curl ~ jq ë¡œ redirect url ì·¨ë“
        run: |
          redirect_download_url=$(curl \
            -H "Authorization: token ${{ secrets.FOR_FETCH_ARTIFACTS }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/teple/simple-language-selector/actions/artifacts" | \
            jq -r ".artifacts[0].archive_download_url")
      # echo redirect_download_url
      - name: echo redirect_download_url
        run: echo $redirect_download_url
